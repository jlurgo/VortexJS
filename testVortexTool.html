<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Prueba de vx</title>
	</head>
	
	<body>
		<button id="btn_initCache">Inicializa cache</button>
		<button id="btn_setCache">Set cache</button>
		<button id="btn_getCache">Get cache</button>
		
		<button id="btn_setRespondedor">setear respondedor</button>
		<button id="btn_sendConRespuesta">vx.send con respuesta</button>
		<button id="btn_publicarFiltros">publicar filtros a la vieja usansa</button>
		<button id="btn_enviarMensaje">enviar mensaje a la vieja usansa</button>
		
		
    </body>
    
    <div id="plantillas">
        <div class="mercader_en_lista">
            <div id="nombre"></div>
        </div>
        <div class="panel_inventario"></div>
        <div class="producto_en_inventario">
            <div id="nombre"></div>
            <div id="btn_eliminar">x</div>
        </div>        
    </div>
    
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
	<!--
    <script type="text/javascript" src="underscore-min.js"></script> 
    <script type="text/javascript" src="Alertify/alertify.min.js"></script> 
    <script type="text/javascript" src="select2-3.4.5/select2.min.js"></script> 
    -->
    <script type="text/javascript" src="Cryptico.min.js"></script> 
	
    <script type="text/javascript" src="FiltrosYTransformaciones.js"></script>
    <script type="text/javascript" src="NodoClienteHTTP.js"></script> 
    <script type="text/javascript" src="ClonadorDeObjetos.js"></script> 
    <script type="text/javascript" src="GeneradorDeIdMensaje.js"></script> 
    <script type="text/javascript" src="NodoClienteHTTP.js"></script>  
    <script type="text/javascript" src="NodoPortalBidi.js"></script> 
    <script type="text/javascript" src="NodoPortalBidiMonoFiltro.js"></script> 
    <script type="text/javascript" src="NodoRouter.js"></script> 
    <script type="text/javascript" src="PataConectora.js"></script> 
    <script type="text/javascript" src="NodoConectorSocket.js"></script>
    <script type="text/javascript" src="socket.io.js"></script>
    <script type="text/javascript" src="Vortex.js"></script> 
    
    <script>
        $(function() {
            
			vx.start({verbose:false});

			vx.conectarPorWebSockets({
				url:'https://router-vortex.herokuapp.com' 
			});   
			
			
			
			
			
			$('#btn_setRespondedor').on('click',function(){
				//////Esto lo haria un nodo lejano que quiere responder cosas
				vx.when({
					filtro: {
						tipoDeMensaje: "test.vx.tool.pregunta"
					},
					callback: function(obj){
						
						console.log('me llegó una pregunta: ', obj);
						
						vx.send({
							tipoDeMensaje: "test.vx.tool.respuesta",
							idResponse: obj.idResponse,
							respuesta: true,
							loco: "las cosas son un flash"
						});
					}
				});
			});
			/////////
			
			
			
			$('#btn_sendConRespuesta').on('click',function(){
				/////Mensaje con respuesta
				vx.send({
					tipoDeMensaje: "test.vx.tool.pregunta",
					che: "que son las cosas?"
				},function(obj){
					console.log('respuesta a la pregunta:', obj);
				});
				//////////
			})
				
			$('#btn_publicarFiltros').on('click',function(){
				vx.pedirMensajes({
					filtro: {
						tipoDeMensaje:"test.chota"
					},
					callback: function(mensaje){
						console.log("llego: " + JSON.stringify(mensaje));
					}
				});
			});
			
			$('#btn_enviarMensaje').on('click',function(){
				vx.enviarMensaje({
					tipoDeMensaje:"test.chota",
					datun:"dale que baila"
				});
			});
				
			
			$('#btn_initCache').on('click', function(){
				///cache
				vx.cache({add: 'unalista'});
				vx.cache({add: 'undato'});
				
				console.log('dato recien metido en la cache', vx.cache('unalista'));
				
				vx.cache('unalista', ['es', 'este']);
				vx.cache('undato', 666);
				
				console.log('una lista en la cache actualizado localmente ', vx.cache('unalista'));
			});
			
			
			$('#btn_setCache').on('click', function(){
				event.preventDefault();
				
				vx.send({
					tipoDeMensaje: 'vortex.cache',
					clave: 'unalista',
					valor: ['otro', 'dato', 'distinto']
				});
				
				vx.send({
					tipoDeMensaje: 'vortex.cache',
					clave: 'undato',
					valor: 555
				});
				
			});
			
			$('#btn_getCache').on('click', function(){
				event.preventDefault();
				
				console.log('una lista en la cache actualizado ', vx.cache('unalista'));
				console.log('un dato en la cache actualizado ', vx.cache('undato'));
			});
			
			////////////
        });
    </script>

    <script type="text/javascript" src="phonegap.js"></script>
</html>